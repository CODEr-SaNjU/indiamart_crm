{% block content %}
<div class="col-12">
    <a data-toggle="modal"  class="btn btn-primary  btn-sm btn-block js-create-enq" style="margin-top: -13px;" href="#" data-target="#Newaddenq">Add New Enquiry </a>
    <table class="table table-hover table-sm" style="padding: 100px; font-size: small;">
      <thead>
        <tr>
          <th>Query_id</th>
          <th>SenderName</th>
          <th>MOB</th>
          <th>SenderEmail</th>
          <th>Subject</th>
          <th>ENQ_MESSAGE</th>
          <th>ENQ_CITY</th>
          <th>ENQ_STATE</th>
          <th>Date_Time_Re</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody>
        {% for i in last_all_enq %}
        <tr>
          <td>{{i.QUERY_ID}}</td>
          <td>{{i.SENDERNAME}}</td>
          <td>{{i.MOB}}</td>
          <td>{{i.SENDEREMAIL}}</td>
          <td>{{i.SUBJECT}}</td>
          <td>{{i.ENQ_MESSAGE|safe|truncatewords:"8"|linebreaks}}</td>
          <td>{{i.ENQ_CITY}}</td>
          <td>{{i.ENQ_STATE}}</td>
          <td>{{i.DATE_TIME_RE}}</td>
          <td><a data-toggle="modal" style="color: black;" href="{%url 'Enquiry_Update' i.id %}" data-target="#exampleModal">Edit</a> &nbsp; <a data-toggle="modal" style="color:red" href="{%url 'Enquiry_Delete' i.id %}" data-target="#deleteModal">Delete</a></td>
        </tr>
        {% empty %}
        <tr>
          <td  class="text-center bg-warning">No Enquiry</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
</div>
<div class="modal fade" id="Newaddenq" tabindex="-1" aria-labelledby="NewaddenqLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      {%  include 'html_files/add_enq.htm' %}
    </div>
  </div>
</div>

<script>

  $(function () {
  
    $(".js-create-enq").click(function () {
      $.ajax({
        url: "{% url 'enq_create' %}",
        type: 'get',
        dataType: 'json',
        beforeSend: function () {
          console.log("before send ");
          $("#Newaddenq").modal("show");
        },
        success: function (data) {
          console.log("success");
          $("#Newaddenq .modal-content").html(data.html_form)
        }
      });
    });
  
  });


  $("#Newaddenq").on("submit", ".js-create-enq-form", function () {
  var form = $(this);
  $.ajax({
    url: form.attr("action"),
    data: form.serialize(),
    type: form.attr("method"),
    dataType: 'json',
    success: function (data) {
      console.log("before send ");
      if (data.form_is_valid) {
        alert("Book created!");  // <-- This is just a placeholder for now for testing
      }
      else {
        $("#Newaddenq .modal-content").html(data.html_form);
        }
      }
    });
    return false;
  });

  </script>
{% endblock %}